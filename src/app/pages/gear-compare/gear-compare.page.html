<ion-header class="ion-no-border">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-menu-button></ion-menu-button>
    </ion-buttons>
    <ion-title>Gear Compare</ion-title>
  </ion-toolbar>
</ion-header>

<div *ngIf="helpGif" class="img-container" (click)="hideHelp()">
  <img [src]="helpGif" class="popup-img"/>
</div>

<ion-content [fullscreen]="true">
  <ion-grid>
    <ion-row>
      <ion-segment mode="ios" [value]="typeSelected" (ionChange)="segmentChanged($event)">
        <ion-segment-button value="Manual">
          <ion-label>Manual</ion-label>
        </ion-segment-button>
        <ion-segment-button value="Auto">
          <ion-label>From My Character</ion-label>
        </ion-segment-button>
      </ion-segment>
    </ion-row>
    <div *ngIf="typeSelected=='Manual'">
      <ion-row>
        <ion-card>
          <ion-card-header class="stats">
            <ion-card-title>
              Your Stats <ion-icon name="help-circle-outline" (click)="showHelp('stats')"></ion-icon>
            </ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <ion-label class="subtitle">Input your stat below</ion-label>
            <ion-list>
              <ion-item lines="none" class="ion-text-wrap">
                <ion-grid>
                  <ion-row>
                    <ion-col size="12">
                      <ion-button fill="outline" (click)="changeElement()" [ngClass]="'Element_'+elementSelected">
                        <ion-avatar slot="start"><img [src]="'assets/icon/elements/Element_'+elementSelected+'.png'"/></ion-avatar>{{elementSelected}} Attack
                      </ion-button>
                    </ion-col>
                  </ion-row>
                  <ion-row>
                    <ion-col size="5"><ion-input type="number" label="Base Attack" labelPlacement="stacked" placeholder="0" [(ngModel)]="yourStats.baseAtk" (ionInput)="recalcEquip('all')"></ion-input></ion-col>
                    <ion-col size="auto" class="plus_sign">+</ion-col>
                    <ion-col size="5"><ion-input type="number" label="Bonus Attack" labelPlacement="stacked" placeholder="0" [(ngModel)]="yourStats.bonusAtk" (ionInput)="recalcEquip('all')"></ion-input></ion-col>
                  </ion-row>
                </ion-grid>
              </ion-item>
            </ion-list>
          </ion-card-content>
        </ion-card>
      </ion-row>
      <ion-row>
        <ion-card>
          <ion-card-header class="eqinfo">
            <ion-card-title>
              Equipment Info <ion-icon name="help-circle-outline" (click)="showHelp('eqinfo')"></ion-icon>
            </ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <ion-label class="subtitle">Input equipment basic stat and enhancement below</ion-label>
            <ion-list>
              <ion-item lines="none" class="ion-text-wrap">
                <ion-grid>
                  <ion-row>
                    <ion-col size="12">
                      <ion-button class="gear" fill="outline" (click)="changeGear()" [ngClass]="'Element_'+elementSelected">
                        <ion-avatar slot="start"><img [src]="'assets/icon/equipments/'+gearSelected.type+' '+gearSelected.rarity+'.png'"/></ion-avatar>{{gearSelected.type}}
                      </ion-button>
                    </ion-col>
                  </ion-row>
                  <ion-row>
                    <ion-col size="5"><ion-input type="number" label="Base Attack" labelPlacement="stacked" placeholder="0" [(ngModel)]="sharedStats.baseAtk" (ionInput)="recalcEquip('all')"></ion-input></ion-col>
                    <ion-col size="auto" class="plus_sign">+</ion-col>
                    <ion-col size="5"><ion-input type="number" label="Enhancement" labelPlacement="stacked" placeholder="0" [(ngModel)]="sharedStats.enhanceAtk" (ionInput)="recalcEquip('all')"></ion-input></ion-col>
                  </ion-row>
                  <ion-row>
                    <ion-col size="auto"><ion-input type="number" label="Enhancement Unlocked (Attack)" labelPlacement="stacked" placeholder="0" [(ngModel)]="sharedStats.bonusAtk" (ionInput)="recalcEquip('all')"></ion-input></ion-col>
                  </ion-row>
                </ion-grid>
              </ion-item>
            </ion-list>
          </ion-card-content>
        </ion-card>
      </ion-row>
      <ion-row class="equip">
        <ion-card class="container">
          <ion-card-header>
            <ion-card-title>Let's Compare!</ion-card-title>
            <div class="btn-grp">
              <ion-button *ngIf="equipment.length>0" color="warning" class="btn share-btn" fill="outline" size="small" (click)="urlShare()"><ion-icon name="share-social-outline"></ion-icon></ion-button>
              <ion-button *ngIf="equipment.length>0" color="warning" class="btn share-btn" fill="outline" size="small" (click)="urlShare(false)"><ion-icon name="link-outline"></ion-icon></ion-button>
              <ion-button color="warning" class="btn add-btn" fill="outline" size="small" (click)="addEquipment()"><ion-icon name="add-circle-outline"></ion-icon>Add</ion-button>
            </div>
          </ion-card-header>
          <ion-card-content>
            <ion-radio-group [allowEmptySelection]="true" [(ngModel)]="equipped" (ionChange)="changeEquipped()">
              <ion-card *ngFor="let e of equipment; let i=index">
                <ion-card-header>
                  <ion-card-title>Equip {{i+1}}</ion-card-title>
                    <ion-button color="danger" class="btn del-btn" fill="outline" size="small" (click)="removeEquipment(i)"><ion-icon name="remove-circle-outline"></ion-icon>Remove</ion-button>
                </ion-card-header>
                <ion-card-content>
                  <ion-list>
                    <ion-item lines="none" class="ion-text-wrap">
                      <ion-grid>
                        <ion-row>
                          <ion-col size="auto"><ion-input type="number" label="Attack" labelPlacement="stacked" placeholder="0" [(ngModel)]="e.attack" (ionInput)="recalcEquip(i)"></ion-input></ion-col>
                          <ion-col size="auto"><ion-input type="number" [label]="elementSelected+' Attack'" labelPlacement="stacked" placeholder="0" [(ngModel)]="e.eleAttack" (ionInput)="recalcEquip(i)"></ion-input></ion-col>
                          <ion-col size="auto"><ion-input type="number" [label]="elementSelected+' Attack %'" labelPlacement="stacked" placeholder="0" [(ngModel)]="e.eleAttackPercent" (ionInput)="recalcEquip(i)"></ion-input></ion-col>
                        </ion-row>
                        <ion-row>
                          <ion-col size="auto"><ion-radio color="warning" labelPlacement="end" [value]="i">Equipped</ion-radio></ion-col>
                          <ion-col size="auto"><ion-input type="text" [label]="'Total '+elementSelected+' Attack (Calculated)'" labelPlacement="stacked" placeholder="0" readonly [value]="e.calculated.base+' + '+e.calculated.percent+' = '+e.calculated.total" [ngClass]="'result Element_'+elementSelected"></ion-input></ion-col>
                          <ion-col size="auto"><ion-input type="text" [label]="'Attack Gained (Calculated)'" labelPlacement="stacked" placeholder="0" readonly [value]="e.calculated.gain" [ngClass]="'result Element_'+elementSelected"></ion-input></ion-col>
                        </ion-row>
                      </ion-grid>
                    </ion-item>
                  </ion-list>
                </ion-card-content>
              </ion-card>
            </ion-radio-group>
          </ion-card-content>
        </ion-card>
      </ion-row>
    </div>
    <div *ngIf="typeSelected=='Auto'">
      <ion-row>
        <ion-card>
          <ion-card-header class="stats">
            <ion-card-title>Your Character</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <ion-label class="subtitle">Edit in <a class="link" (click)="goMyChar()">My Character</a></ion-label>
            <ion-list>
              <ion-item lines="none" class="ion-text-wrap">
                <ion-grid>
                  <ion-row>
                    <ion-col size="12" class="justify-mid" *ngIf="char.charAvailable.length>0">
                      <ion-select mode="ios" (ionChange)="reloadChar()" justify="space-between" label="Selected Character" [(ngModel)]="selectedChar">
                        <ion-select-option value="">Select Character</ion-select-option>
                        <ion-select-option *ngFor="let c of char.charAvailable" [value]="c.id">{{[c.name??'No Name',c.uid??'Empty UID'].join(' - ')}}</ion-select-option>
                      </ion-select>
                    </ion-col>
                    <ion-col size="12" class="justify-mid" *ngIf="char.charAvailable.length==0">
                      <ion-label>No character available!<br>Configure it first <a class="link" (click)="goMyChar()">over here</a></ion-label>
                    </ion-col>
                  </ion-row>
                </ion-grid>
              </ion-item>
            </ion-list>
          </ion-card-content>
        </ion-card>
      </ion-row>
      <div *ngIf="selectedChar!=''">
        <ion-row>
          <ion-card>
            <ion-card-header>
              <ion-card-title>Equipment</ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <ion-toggle color="warning" [enableOnOffLabels]="true" [(ngModel)]="multiType" class="changed-stat">Multi parts compare</ion-toggle>
              <ion-list *ngIf="multiType">
                <ion-item lines="none" class="ion-text-wrap">
                  <ion-grid>
                    <ion-row *ngFor="let eqType of eqOrder">
                      <ion-col class="equipments">
                        <div class="choosen-eq" *ngIf="curChar.gear[eqType].rarity!=null">
                          <div class="choose">
                            <ion-img (click)="eqChange(eqType)" [src]="'assets/icon/equipments/'+eqType+'%20'+curChar.gear[eqType].rarity+'.png'"></ion-img>
                          </div>
                          <div class="stats">
                            <ion-item lines="none" class="header"><ion-text>Random</ion-text></ion-item>
                            <ion-item lines="none" class="body" *ngFor="let eq of curChar.gear[eqType].random; index as rIdx">
                              <ion-img class="icon" (click)="eqstatChange(eqType,rIdx,'random')" *ngIf="eq.type!=null" [src]="'assets/icon/stats/'+eq.type+'.png'"></ion-img>
                              <ion-img class="icon" (click)="eqstatChange(eqType,rIdx,'random')" *ngIf="eq.type==null" [src]="'assets/icon/equipments/null.svg'"></ion-img>
                              <ion-text [ngClass]="((curChar.gear[eqType].random[rIdx].val>char.characterInfo.gear[eqType].random[rIdx].val)||(char.characterInfo.gear[eqType].rarity==null))?'increase-val':(curChar.gear[eqType].random[rIdx].val<char.characterInfo.gear[eqType].random[rIdx].val)?'decrease-val':''" [id]="'rand-'+eqType+'-'+rIdx+'val'">{{eq.type?eq.val:'-'}}</ion-text>
                              <ion-popover *ngIf="eq.type" [trigger]="'rand-'+eqType+'-'+rIdx+'val'" triggerAction="click">
                                <ng-template>
                                  <ion-content class="popups">
                                    <ion-text class="title">Change {{beautifyStatString(eq.type)}} Value</ion-text>
                                    <ion-input (ionChange)="recalcStat()" type="number" [(ngModel)]="curChar.gear[eqType].random[rIdx].val"></ion-input>
                                  </ion-content>
                                </ng-template>
                              </ion-popover>
                            </ion-item>
                            <ion-item lines="none" class="header"><ion-text>Augment</ion-text></ion-item>
                            <div *ngIf="curChar.gear[eqType].rarity!='5'">
                              <ion-item lines="none" class="body" *ngFor="let eqa of curChar.gear[eqType].augment; index as arIdx">
                                <ion-img class="icon" (click)="eqstatChange(eqType,arIdx,'augment')" *ngIf="eqa.type!=null && (curChar.gear[eqType].rarity=='Augment'||curChar.gear[eqType].rarity=='Titan')" [src]="'assets/icon/stats/'+eqa.type+'.png'"></ion-img>
                                <ion-img class="icon" (click)="eqstatChange(eqType,arIdx,'augment')" *ngIf="eqa.type==null || curChar.gear[eqType].rarity=='5'" [src]="'assets/icon/equipments/null.svg'"></ion-img>
                                <ion-text [ngClass]="((curChar.gear[eqType].augment[arIdx].val>char.characterInfo.gear[eqType].augment[arIdx].val)||(char.characterInfo.gear[eqType].rarity=='5')||(char.characterInfo.gear[eqType].rarity==null))?'increase-val':(curChar.gear[eqType].augment[arIdx].val<char.characterInfo.gear[eqType].augment[arIdx].val)?'decrease-val':''" [id]="'randa-'+eqType+'-'+arIdx+'val'">{{eqa.type?eqa.val:'-'}}</ion-text>
                                <ion-popover *ngIf="eqa.type" [trigger]="'randa-'+eqType+'-'+arIdx+'val'" triggerAction="click">
                                  <ng-template>
                                    <ion-content class="popups">
                                      <ion-text class="title">Change {{beautifyStatString(eqa.type)}} Value</ion-text>
                                      <ion-input (ionChange)="recalcStat()" type="number" [(ngModel)]="curChar.gear[eqType].augment[arIdx].val"></ion-input>
                                    </ion-content>
                                  </ng-template>
                                </ion-popover>
                              </ion-item>
                            </div>
                            <div *ngIf="curChar.gear[eqType].rarity=='5'">
                              <ion-item lines="none" class="body-locked">
                                <ion-icon name="lock-closed" color="medium"></ion-icon>
                              </ion-item>
                            </div>
                            <div *ngIf="curChar.gear[eqType].rarity=='Titan'">
                              <ion-item lines="none" class="body">
                                <ion-img class="icon" (click)="eqtitanChange(eqType)" *ngIf="curChar.gear[eqType].rare.type!=null" [src]="'assets/icon/stats/'+curChar.gear[eqType].rare.type+'.png'"></ion-img>
                                <ion-img class="icon" (click)="eqtitanChange(eqType)" *ngIf="curChar.gear[eqType].rare.type==null" [src]="'assets/icon/equipments/null.svg'"></ion-img>
                                <ion-text [ngClass]="((curChar.gear[eqType].rare.val>char.characterInfo.gear[eqType].rare.val)||(char.characterInfo.gear[eqType].rarity!='Titan')||(char.characterInfo.gear[eqType].rarity==null))?'increase-val':(curChar.gear[eqType].rare.val<char.characterInfo.gear[eqType].rare.val)?'decrease-val':''" [id]="'rare-'+eqType">{{curChar.gear[eqType].rare.type?curChar.gear[eqType].rare.val:'-'}}</ion-text>
                                <ion-popover *ngIf="curChar.gear[eqType].rare.type!=null" [trigger]="'rare-'+eqType" triggerAction="click">
                                  <ng-template>
                                    <ion-content class="popups">
                                      <ion-text class="title">Change {{beautifyStatString(curChar.gear[eqType].rare.type)}} Level</ion-text>
                                      <ion-range (ionChange)="recalcStat()" color="warning" [(ngModel)]="curChar.gear[eqType].rare.val" [min]="1" [max]="3" [pin]="true"></ion-range>
                                    </ion-content>
                                  </ng-template>
                                </ion-popover>
                              </ion-item>
                            </div>
                            <div *ngIf="curChar.gear[eqType].rarity=='Augment'">
                              <ion-item lines="none" class="titan-locked">
                                <ion-icon name="lock-closed" color="medium"></ion-icon>
                              </ion-item>
                            </div>
                          </div>
                        </div>
                        <div class="null-eq" *ngIf="curChar.gear[eqType].rarity==null">
                          <div (click)="eqChange(eqType)" class="eq-background-null">
                            <ion-img [src]="'assets/icon/equipments/'+eqType+'.png'"></ion-img>
                          </div>
                        </div>
                      </ion-col>
                    </ion-row>
                  </ion-grid>
                </ion-item>
              </ion-list>
              <div *ngIf="!multiType">
                <ion-list>
                  <ion-item lines="none" class="ion-text-wrap">
                    <ion-grid>
                      <ion-row>
                        <ion-col class="equipments">
                          <div class="choosen-eq" *ngIf="char.characterInfo.gear[singleType].rarity!=null">
                            <div class="choose showstats">
                              <ion-icon (click)="typeChange()" class="type-change" name="settings-outline"></ion-icon>
                              <ion-img class="nochange" [src]="'assets/icon/equipments/'+singleType+'%20'+char.characterInfo.gear[singleType].rarity+'.png'"></ion-img>
                              <ion-text class="equipped-text">Equipped</ion-text>
                            </div>
                            <div class="stats showstats">
                              <ion-item lines="none" class="header"><ion-text>Random</ion-text></ion-item>
                              <ion-item lines="none" class="body" *ngFor="let eq of char.characterInfo.gear[singleType].random; index as rIdx">
                                <ion-img class="icon nochange" *ngIf="eq.type!=null" [src]="'assets/icon/stats/'+eq.type+'.png'"></ion-img>
                                <ion-img class="icon nochange" *ngIf="eq.type==null" [src]="'assets/icon/equipments/null.svg'"></ion-img>
                                <ion-text class="nochange">{{eq.type?eq.val:'-'}}</ion-text>
                              </ion-item>
                              <ion-item lines="none" class="header"><ion-text>Augment</ion-text></ion-item>
                              <div *ngIf="char.characterInfo.gear[singleType].rarity!='5'">
                                <ion-item lines="none" class="body" *ngFor="let eqa of char.characterInfo.gear[singleType].augment; index as arIdx">
                                  <ion-img class="icon nochange" *ngIf="eqa.type!=null && (char.characterInfo.gear[singleType].rarity=='Augment'||char.characterInfo.gear[singleType].rarity=='Titan')" [src]="'assets/icon/stats/'+eqa.type+'.png'"></ion-img>
                                  <ion-img class="icon nochange" *ngIf="eqa.type==null || char.characterInfo.gear[singleType].rarity=='5'" [src]="'assets/icon/equipments/null.svg'"></ion-img>
                                  <ion-text class="nochange">{{eqa.type?eqa.val:'-'}}</ion-text>
                                </ion-item>
                              </div>
                              <div *ngIf="char.characterInfo.gear[singleType].rarity=='5'">
                                <ion-item lines="none" class="body-locked">
                                  <ion-icon name="lock-closed" color="medium"></ion-icon>
                                </ion-item>
                              </div>
                              <div *ngIf="char.characterInfo.gear[singleType].rarity=='Titan'">
                                <ion-item lines="none" class="body">
                                  <ion-img class="icon nochange" *ngIf="char.characterInfo.gear[singleType].rare.type!=null" [src]="'assets/icon/stats/'+char.characterInfo.gear[singleType].rare.type+'.png'"></ion-img>
                                  <ion-img class="icon nochange" *ngIf="char.characterInfo.gear[singleType].rare.type==null" [src]="'assets/icon/equipments/null.svg'"></ion-img>
                                  <ion-text class="nochange">{{char.characterInfo.gear[singleType].rare.type?char.characterInfo.gear[singleType].rare.val:'-'}}</ion-text>
                                </ion-item>
                              </div>
                              <div *ngIf="char.characterInfo.gear[singleType].rarity=='Augment'">
                                <ion-item lines="none" class="titan-locked">
                                  <ion-icon name="lock-closed" color="medium"></ion-icon>
                                </ion-item>
                              </div>
                            </div>
                          </div>
                          <div class="null-eq" *ngIf="char.characterInfo.gear[singleType].rarity==null">
                            <div class="nochange eq-background-null showstats">
                              <ion-icon (click)="typeChange()" color="dark" class="type-change" name="settings"></ion-icon>
                              <ion-img [src]="'assets/icon/equipments/'+singleType+'.png'"></ion-img>
                            </div>
                          </div>
                          <div class="eqstats">
                            <ion-item lines="none" *ngIf="compareStats.length==0">
                              <ion-text><i>Nothing changed yet...</i></ion-text><br>
                            </ion-item>
                            <ion-item *ngFor="let s of compareStats" lines="none" class="comparing-single">
                              <ion-img [src]="'assets/icon/stats/'+s.iconname+'.png'"></ion-img>
                              <div class="stat-val singlegear">
                                <ion-text>{{s.name}}</ion-text><br>
                                <ion-text>{{s.val}}</ion-text>
                              </div>
                            </ion-item>
                          </div>
                        </ion-col>
                        <ion-col class="equipments" *ngFor="let eqcompare of gearsCompare; index as gIdx">
                          <div class="choosen-eq" *ngIf="eqcompare.rarity!=null">
                            <div class="choose showstats">
                              <ion-text>New: {{gIdx+1}}</ion-text>
                              <ion-img (click)="eqcompareChange(singleType,eqcompare.id)" [src]="'assets/icon/equipments/'+singleType+'%20'+eqcompare.rarity+'.png'"></ion-img>
                              <ion-icon (click)="delCompare(eqcompare.id)" class="del-btn" name="trash-bin-outline"></ion-icon>
                            </div>
                            <div class="stats showstats">
                              <ion-item lines="none" class="header"><ion-text>Random</ion-text></ion-item>
                              <ion-item lines="none" class="body" *ngFor="let eq of eqcompare.random; index as rIdx">
                                <ion-img class="icon" (click)="eqcomparestatChange(singleType,rIdx,'random',eqcompare.id)" *ngIf="eq.type!=null" [src]="'assets/icon/stats/'+eq.type+'.png'"></ion-img>
                                <ion-img class="icon" (click)="eqcomparestatChange(singleType,rIdx,'random',eqcompare.id)" *ngIf="eq.type==null" [src]="'assets/icon/equipments/null.svg'"></ion-img>
                                <ion-text [ngClass]="(eqcompare.random[rIdx].val>char.characterInfo.gear[singleType].random[rIdx].val)?'increase-val':(eqcompare.random[rIdx].val<char.characterInfo.gear[singleType].random[rIdx].val)?'decrease-val':''" [id]="'rand-'+singleType+eqcompare.id+'-'+rIdx+'val'">{{eq.type?eq.val:'-'}}</ion-text>
                                <ion-popover *ngIf="eq.type" [trigger]="'rand-'+singleType+eqcompare.id+'-'+rIdx+'val'" triggerAction="click">
                                  <ng-template>
                                    <ion-content class="popups">
                                      <ion-text class="title">Change {{beautifyStatString(eq.type)}} Value</ion-text>
                                      <ion-input (ionChange)="recalcCompareStat()" type="number" [(ngModel)]="eqcompare.random[rIdx].val"></ion-input>
                                    </ion-content>
                                  </ng-template>
                                </ion-popover>
                              </ion-item>
                              <ion-item lines="none" class="header"><ion-text>Augment</ion-text></ion-item>
                              <div *ngIf="eqcompare.rarity!='5'">
                                <ion-item lines="none" class="body" *ngFor="let eqa of eqcompare.augment; index as arIdx">
                                  <ion-img class="icon" (click)="eqcomparestatChange(singleType,arIdx,'augment',eqcompare.id)" *ngIf="eqa.type!=null && (eqcompare.rarity=='Augment'||eqcompare.rarity=='Titan')" [src]="'assets/icon/stats/'+eqa.type+'.png'"></ion-img>
                                  <ion-img class="icon" (click)="eqcomparestatChange(singleType,arIdx,'augment',eqcompare.id)" *ngIf="eqa.type==null || eqcompare.rarity=='5'" [src]="'assets/icon/equipments/null.svg'"></ion-img>
                                  <ion-text [ngClass]="(eqcompare.augment[arIdx].val>char.characterInfo.gear[singleType].augment[arIdx].val)||(char.characterInfo.gear[singleType].rarity=='5')?'increase-val':(eqcompare.augment[arIdx].val<char.characterInfo.gear[singleType].augment[arIdx].val)?'decrease-val':''" [id]="'randa-'+singleType+eqcompare.id+'-'+arIdx+'val'">{{eqa.type?eqa.val:'-'}}</ion-text>
                                  <ion-popover *ngIf="eqa.type" [trigger]="'randa-'+singleType+eqcompare.id+'-'+arIdx+'val'" triggerAction="click">
                                    <ng-template>
                                      <ion-content class="popups">
                                        <ion-text class="title">Change {{beautifyStatString(eqa.type)}} Value</ion-text>
                                        <ion-input (ionChange)="recalcCompareStat()" type="number" [(ngModel)]="eqcompare.augment[arIdx].val"></ion-input>
                                      </ion-content>
                                    </ng-template>
                                  </ion-popover>
                                </ion-item>
                              </div>
                              <div *ngIf="eqcompare.rarity=='5'">
                                <ion-item lines="none" class="body-locked">
                                  <ion-icon name="lock-closed" color="medium"></ion-icon>
                                </ion-item>
                              </div>
                              <div *ngIf="eqcompare.rarity=='Titan'">
                                <ion-item lines="none" class="body">
                                  <ion-img class="icon" (click)="eqcomparetitanChange(singleType,eqcompare.id)" *ngIf="eqcompare.rare.type!=null" [src]="'assets/icon/stats/'+eqcompare.rare.type+'.png'"></ion-img>
                                  <ion-img class="icon" (click)="eqcomparetitanChange(singleType,eqcompare.id)" *ngIf="eqcompare.rare.type==null" [src]="'assets/icon/equipments/null.svg'"></ion-img>
                                  <ion-text [ngClass]="((eqcompare.rare.val>char.characterInfo.gear[singleType].rare.val)||(char.characterInfo.gear[singleType].rarity!='Titan'))?'increase-val':(eqcompare.rare.val<char.characterInfo.gear[singleType].rare.val)?'decrease-val':''" [id]="'rare-'+singleType+eqcompare.id">{{eqcompare.rare.type?eqcompare.rare.val:'-'}}</ion-text>
                                  <ion-popover *ngIf="eqcompare.rare.type!=null" [trigger]="'rare-'+singleType+eqcompare.id" triggerAction="click">
                                    <ng-template>
                                      <ion-content class="popups">
                                        <ion-text class="title">Change {{beautifyStatString(eqcompare.rare.type)}} Level</ion-text>
                                        <ion-range (ionChange)="recalcCompareStat()" color="warning" [(ngModel)]="eqcompare.rare.val" [min]="1" [max]="3" [pin]="true"></ion-range>
                                      </ion-content>
                                    </ng-template>
                                  </ion-popover>
                                </ion-item>
                              </div>
                              <div *ngIf="eqcompare.rarity=='Augment'">
                                <ion-item lines="none" class="titan-locked">
                                  <ion-icon name="lock-closed" color="medium"></ion-icon>
                                </ion-item>
                              </div>
                            </div>
                          </div>
                          <div class="null-eq" *ngIf="eqcompare.rarity==null">
                            <ion-icon (click)="delCompare(eqcompare.id)" class="del-btn" name="trash-bin"></ion-icon>
                            <div (click)="eqcompareChange(singleType,eqcompare.id)" class="eq-background-null showstats">
                              <ion-img [src]="'assets/icon/equipments/'+singleType+'.png'"></ion-img>
                            </div>
                          </div>
                          <div class="eqstats">
                            <ion-item lines="none" *ngIf="eqcompare.compareStats.length==0">
                              <ion-text><i>Nothing changed yet...</i></ion-text><br>
                            </ion-item>
                            <ion-item *ngFor="let s of eqcompare.compareStats" lines="none" class="comparing-single">
                              <ion-img [src]="'assets/icon/stats/'+s.iconname+'.png'"></ion-img>
                              <div class="stat-val singlegear">
                                <ion-text>{{s.name}}</ion-text><br>
                                <ion-text>{{s.val}}</ion-text>
                                <ion-text class="stat-diff" [ngClass]="s.increase>0?'increase-val':'decrease-val'"><ion-icon [name]="s.increase>0?'caret-up':'caret-down'"></ion-icon>{{s.increase}}</ion-text>
                              </div>
                            </ion-item>
                          </div>
                        </ion-col>
                        <ion-col class="equipments">
                          <div (click)="newCompare()" class="new-eq">
                            <ion-icon name="add-circle"></ion-icon>
                          </div>
                        </ion-col>
                      </ion-row>
                    </ion-grid>
                  </ion-item>
                </ion-list>
              </div>
            </ion-card-content>
          </ion-card>
        </ion-row>
        <ion-row *ngIf="multiType">
          <ion-card>
            <ion-card-header>
              <ion-card-title>Stats (Calculated)</ion-card-title>
            </ion-card-header>
            <ion-card-content>
              <ion-toggle color="warning" [enableOnOffLabels]="true" [(ngModel)]="changedOnly" class="changed-stat">Show changed stats only</ion-toggle>
              <ion-list class="calculated">
                <ion-item *ngIf="!changedOnly" lines="none" class="ion-text-wrap">
                  <ion-grid>
                    <ion-row>
                      <ion-col>
                        <ion-item lines="none" class="ion-text-wrap">
                          <ion-img src="assets/icon/stats/HP.png"></ion-img>
                          <div class="stat-val">
                            <ion-text>HP</ion-text><br>
                            <ion-text>{{hp}}</ion-text>
                            <ion-text *ngIf="hp!=hpOld" class="stat-diff" [ngClass]="hp>hpOld?'increase-val':'decrease-val'"><ion-icon [name]="hp>hpOld?'caret-up':'caret-down'"></ion-icon>{{hp-hpOld}}</ion-text>
                          </div>
                        </ion-item>
                        <ion-item lines="none" class="ion-text-wrap">
                          <ion-img src="assets/icon/stats/Crit.png"></ion-img>
                          <div class="stat-val">
                            <ion-text>Crit</ion-text><br>
                            <ion-text>{{crit}}</ion-text>
                            <ion-text *ngIf="crit!=critOld" class="stat-diff" [ngClass]="crit>critOld?'increase-val':'decrease-val'"><ion-icon [name]="crit>critOld?'caret-up':'caret-down'"></ion-icon>{{crit-critOld}}</ion-text>
                            <span class="tooltip">Against level <div class="highlight">{{curChar.level}}</div><br>Equal to <div class="highlight">{{critPCalc}}%</div></span>
                          </div>
                        </ion-item>
                        <ion-item lines="none" class="ion-text-wrap">
                          <ion-img src="assets/icon/stats/PhysicalAttack.png"></ion-img>
                          <div class="stat-val">
                            <ion-text>Physical Attack</ion-text><br>
                            <ion-text>{{physicalAtk}}</ion-text>
                            <ion-text *ngIf="physicalAtk!=physicalAtkOld" class="stat-diff" [ngClass]="physicalAtk>physicalAtkOld?'increase-val':'decrease-val'"><ion-icon [name]="physicalAtk>physicalAtkOld?'caret-up':'caret-down'"></ion-icon>{{physicalAtk-physicalAtkOld}}</ion-text>
                            <span class="tooltip"><div class="highlight">{{physicalAtkB}}</div> + <div class="highlight">{{physicalAtkP}}</div><br>Physical Damage: <div class="highlight">{{physicalDam}}%</div></span>
                          </div>
                        </ion-item>
                        <ion-item lines="none" class="ion-text-wrap">
                          <ion-img src="assets/icon/stats/FlameAttack.png"></ion-img>
                          <div class="stat-val">
                            <ion-text>Flame Attack</ion-text><br>
                            <ion-text>{{flameAtk}}</ion-text>
                            <ion-text *ngIf="flameAtk!=flameAtkOld" class="stat-diff" [ngClass]="flameAtk>flameAtkOld?'increase-val':'decrease-val'"><ion-icon [name]="flameAtk>flameAtkOld?'caret-up':'caret-down'"></ion-icon>{{flameAtk-flameAtkOld}}</ion-text>
                            <span class="tooltip"><div class="highlight">{{flameAtkB}}</div> + <div class="highlight">{{flameAtkP}}</div><br>Flame Damage: <div class="highlight">{{flameDam}}%</div></span>
                          </div>
                        </ion-item>
                        <ion-item lines="none" class="ion-text-wrap">
                          <ion-img src="assets/icon/stats/FrostAttack.png"></ion-img>
                          <div class="stat-val">
                            <ion-text>Frost Attack</ion-text><br>
                            <ion-text>{{frostAtk}}</ion-text>
                            <ion-text *ngIf="frostAtk!=frostAtkOld" class="stat-diff" [ngClass]="frostAtk>frostAtkOld?'increase-val':'decrease-val'"><ion-icon [name]="frostAtk>frostAtkOld?'caret-up':'caret-down'"></ion-icon>{{frostAtk-frostAtkOld}}</ion-text>
                            <span class="tooltip"><div class="highlight">{{frostAtkB}}</div> + <div class="highlight">{{frostAtkP}}</div><br>Frost Damage: <div class="highlight">{{frostDam}}%</div></span>
                          </div>
                        </ion-item>
                        <ion-item lines="none" class="ion-text-wrap">
                          <ion-img src="assets/icon/stats/VoltAttack.png"></ion-img>
                          <div class="stat-val">
                            <ion-text>Volt Attack</ion-text><br>
                            <ion-text>{{voltAtk}}</ion-text>
                            <ion-text *ngIf="voltAtk!=voltAtkOld" class="stat-diff" [ngClass]="voltAtk>voltAtkOld?'increase-val':'decrease-val'"><ion-icon [name]="voltAtk>voltAtkOld?'caret-up':'caret-down'"></ion-icon>{{voltAtk-voltAtkOld}}</ion-text>
                            <span class="tooltip"><div class="highlight">{{voltAtkB}}</div> + <div class="highlight">{{voltAtkP}}</div><br>Volt Damage: <div class="highlight">{{voltDam}}%</div></span>
                          </div>
                        </ion-item>
                        <ion-item lines="none" class="ion-text-wrap">
                          <ion-img src="assets/icon/stats/AlterAttack.png"></ion-img>
                          <div class="stat-val">
                            <ion-text>Altered Attack</ion-text><br>
                            <ion-text>{{alterAtk}}</ion-text>
                            <ion-text *ngIf="alterAtk!=alterAtkOld" class="stat-diff" [ngClass]="alterAtk>alterAtkOld?'increase-val':'decrease-val'"><ion-icon [name]="alterAtk>alterAtkOld?'caret-up':'caret-down'"></ion-icon>{{alterAtk-alterAtkOld}}</ion-text>
                            <span class="tooltip">Highest: <div class="highlight">{{eleHighest}}</div><br><div class="highlight">{{alterAtkB}}</div> + <div class="highlight">{{alterAtkP}}</div></span>
                          </div>
                        </ion-item>
                      </ion-col>
                      <ion-col>
                        <ion-item lines="none" class="ion-text-wrap">
                          <ion-img src="assets/icon/stats/CritPercent.png"></ion-img>
                          <div class="stat-val">
                            <ion-text>Crit Rate</ion-text><br>
                            <ion-text>{{critPercent}}%</ion-text>
                            <ion-text *ngIf="critPercent!=critPercentOld" class="stat-diff" [ngClass]="critPercent>critPercentOld?'increase-val':'decrease-val'"><ion-icon [name]="critPercent>critPercentOld?'caret-up':'caret-down'"></ion-icon>{{critPercent-critPercentOld}}</ion-text>
                            <span class="tooltip">Against level <div class="highlight">{{curChar.level}}</div><br>Equal to <div class="highlight">{{critBCalc}}</div> Crit stat</span>
                          </div>
                        </ion-item>
                        <ion-item lines="none" class="ion-text-wrap">
                          <ion-img src="assets/icon/stats/CritDamage.png"></ion-img>
                          <div class="stat-val">
                            <ion-text>Crit Damage</ion-text><br>
                            <ion-text>{{critDamage}}%</ion-text>
                          </div>
                        </ion-item>
                        <ion-item lines="none" class="ion-text-wrap">
                          <ion-img src="assets/icon/stats/PhysicalResist.png"></ion-img>
                          <div class="stat-val">
                            <ion-text>Physical Resistance</ion-text><br>
                            <ion-text>{{physicalRes}}</ion-text>
                            <ion-text *ngIf="physicalRes!=physicalResOld" class="stat-diff" [ngClass]="physicalRes>physicalResOld?'increase-val':'decrease-val'"><ion-icon [name]="physicalRes>physicalResOld?'caret-up':'caret-down'"></ion-icon>{{physicalRes-physicalResOld}}</ion-text>
                          </div>
                        </ion-item>
                        <ion-item lines="none" class="ion-text-wrap">
                          <ion-img src="assets/icon/stats/FlameResist.png"></ion-img>
                          <div class="stat-val">
                            <ion-text>Flame Resistance</ion-text><br>
                            <ion-text>{{flameRes}}</ion-text>
                            <ion-text *ngIf="flameRes!=flameResOld" class="stat-diff" [ngClass]="flameRes>flameResOld?'increase-val':'decrease-val'"><ion-icon [name]="flameRes>flameResOld?'caret-up':'caret-down'"></ion-icon>{{flameRes-flameResOld}}</ion-text>
                          </div>
                        </ion-item>
                        <ion-item lines="none" class="ion-text-wrap">
                          <ion-img src="assets/icon/stats/FrostResist.png"></ion-img>
                          <div class="stat-val">
                            <ion-text>Frost Resistance</ion-text><br>
                            <ion-text>{{frostRes}}</ion-text>
                            <ion-text *ngIf="frostRes!=frostResOld" class="stat-diff" [ngClass]="frostRes>frostResOld?'increase-val':'decrease-val'"><ion-icon [name]="frostRes>frostResOld?'caret-up':'caret-down'"></ion-icon>{{frostRes-frostResOld}}</ion-text>
                          </div>
                        </ion-item>
                        <ion-item lines="none" class="ion-text-wrap">
                          <ion-img src="assets/icon/stats/VoltResist.png"></ion-img>
                          <div class="stat-val">
                            <ion-text>Volt Resistance</ion-text><br>
                            <ion-text>{{voltRes}}</ion-text>
                            <ion-text *ngIf="voltRes!=voltResOld" class="stat-diff" [ngClass]="voltRes>voltResOld?'increase-val':'decrease-val'"><ion-icon [name]="voltRes>voltResOld?'caret-up':'caret-down'"></ion-icon>{{voltRes-voltResOld}}</ion-text>
                          </div>
                        </ion-item>
                        <ion-item lines="none" class="ion-text-wrap">
                          <ion-img src="assets/icon/stats/AlterResist.png"></ion-img>
                          <div class="stat-val">
                            <ion-text>Altered Resistance</ion-text><br>
                            <ion-text>{{alterRes}}</ion-text>
                            <ion-text *ngIf="alterRes!=alterResOld" class="stat-diff" [ngClass]="alterRes>alterResOld?'increase-val':'decrease-val'"><ion-icon [name]="alterRes>alterResOld?'caret-up':'caret-down'"></ion-icon>{{alterRes-alterResOld}}</ion-text>
                          </div>
                        </ion-item>
                      </ion-col>
                      <ion-col>
                        <ion-item lines="none" class="ion-text-wrap">
                          <ion-img src="assets/icon/stats/Block.png"></ion-img>
                          <div class="stat-val">
                            <ion-text>Block</ion-text><br>
                            <ion-text>{{titanBlock}}</ion-text>
                            <ion-text *ngIf="titanBlock!=titanBlockOld" class="stat-diff" [ngClass]="titanBlock>titanBlockOld?'increase-val':'decrease-val'"><ion-icon [name]="titanBlock>titanBlockOld?'caret-up':'caret-down'"></ion-icon>{{titanBlock-titanBlockOld}}</ion-text>
                          </div>
                        </ion-item>
                        <ion-item lines="none" class="ion-text-wrap">
                          <ion-img src="assets/icon/stats/Weak.png"></ion-img>
                          <div class="stat-val">
                            <ion-text>Weak Point Damage Boost</ion-text><br>
                            <ion-text>{{titanWeak}}</ion-text>
                            <ion-text *ngIf="titanWeak!=titanWeakOld" class="stat-diff" [ngClass]="titanWeak>titanWeakOld?'increase-val':'decrease-val'"><ion-icon [name]="titanWeak>titanWeakOld?'caret-up':'caret-down'"></ion-icon>{{titanWeak-titanWeakOld}}</ion-text>
                          </div>
                        </ion-item>
                        <ion-item lines="none" class="ion-text-wrap">
                          <ion-img src="assets/icon/stats/Lifesteal.png"></ion-img>
                          <div class="stat-val">
                            <ion-text>Lifesteal</ion-text><br>
                            <ion-text>{{titanLifesteal}}</ion-text>
                            <ion-text *ngIf="titanLifesteal!=titanLifestealOld" class="stat-diff" [ngClass]="titanLifesteal>titanLifestealOld?'increase-val':'decrease-val'"><ion-icon [name]="titanLifesteal>titanLifestealOld?'caret-up':'caret-down'"></ion-icon>{{titanLifesteal-titanLifestealOld}}</ion-text>
                          </div>
                        </ion-item>
                        <ion-item lines="none" class="ion-text-wrap">
                          <ion-img src="assets/icon/stats/Recovery.png"></ion-img>
                          <div class="stat-val">
                            <ion-text>HP Recovery</ion-text><br>
                            <ion-text>{{titanRecovery}}</ion-text>
                            <ion-text *ngIf="titanRecovery!=titanRecoveryOld" class="stat-diff" [ngClass]="titanRecovery>titanRecoveryOld?'increase-val':'decrease-val'"><ion-icon [name]="titanRecovery>titanRecoveryOld?'caret-up':'caret-down'"></ion-icon>{{titanRecovery-titanRecoveryOld}}</ion-text>
                          </div>
                        </ion-item>
                        <ion-item lines="none" class="ion-text-wrap">
                          <ion-img src="assets/icon/stats/Delay.png"></ion-img>
                          <div class="stat-val">
                            <ion-text>Delay</ion-text><br>
                            <ion-text>{{titanDelay}}</ion-text>
                            <ion-text *ngIf="titanDelay!=titanDelayOld" class="stat-diff" [ngClass]="titanDelay>titanDelayOld?'increase-val':'decrease-val'"><ion-icon [name]="titanDelay>titanDelayOld?'caret-up':'caret-down'"></ion-icon>{{titanDelay-titanDelayOld}}</ion-text>
                          </div>
                        </ion-item>
                        <ion-item lines="none" class="ion-text-wrap">
                          <ion-img src="assets/icon/stats/Normal.png"></ion-img>
                          <div class="stat-val">
                            <ion-text>Normal Attack Damage Boost</ion-text><br>
                            <ion-text>{{titanNormal}}</ion-text>
                            <ion-text *ngIf="titanNormal!=titanNormalOld" class="stat-diff" [ngClass]="titanNormal>titanNormalOld?'increase-val':'decrease-val'"><ion-icon [name]="titanNormal>titanNormalOld?'caret-up':'caret-down'"></ion-icon>{{titanNormal-titanNormalOld}}</ion-text>
                          </div>
                        </ion-item>
                      </ion-col>
                      <ion-col>
                        <ion-item lines="none" class="ion-text-wrap">
                          <ion-img src="assets/icon/stats/Dodge.png"></ion-img>
                          <div class="stat-val">
                            <ion-text>Dodge Attack Damage Boost</ion-text><br>
                            <ion-text>{{titanDodge}}</ion-text>
                            <ion-text *ngIf="titanDodge!=titanDodgeOld" class="stat-diff" [ngClass]="titanDodge>titanDodgeOld?'increase-val':'decrease-val'"><ion-icon [name]="titanDodge>titanDodgeOld?'caret-up':'caret-down'"></ion-icon>{{titanDodge-titanDodgeOld}}</ion-text>
                          </div>
                        </ion-item>
                        <ion-item lines="none" class="ion-text-wrap">
                          <ion-img src="assets/icon/stats/Skill.png"></ion-img>
                          <div class="stat-val">
                            <ion-text>Skill Damage Boost</ion-text><br>
                            <ion-text>{{titanSkill}}</ion-text>
                            <ion-text *ngIf="titanSkill!=titanSkillOld" class="stat-diff" [ngClass]="titanSkill>titanSkillOld?'increase-val':'decrease-val'"><ion-icon [name]="titanSkill>titanSkillOld?'caret-up':'caret-down'"></ion-icon>{{titanSkill-titanSkillOld}}</ion-text>
                          </div>
                        </ion-item>
                        <ion-item lines="none" class="ion-text-wrap">
                          <ion-img src="assets/icon/stats/Discharge.png"></ion-img>
                          <div class="stat-val">
                            <ion-text>Discharge Damage Boost</ion-text><br>
                            <ion-text>{{titanDischarge}}</ion-text>
                            <ion-text *ngIf="titanDischarge!=titanDischargeOld" class="stat-diff" [ngClass]="titanDischarge>titanDischargeOld?'increase-val':'decrease-val'"><ion-icon [name]="titanDischarge>titanDischargeOld?'caret-up':'caret-down'"></ion-icon>{{titanDischarge-titanDischargeOld}}</ion-text>
                          </div>
                        </ion-item>
                        <ion-item lines="none" class="ion-text-wrap">
                          <ion-img src="assets/icon/stats/Damage.png"></ion-img>
                          <div class="stat-val">
                            <ion-text>Damage Boost</ion-text><br>
                            <ion-text>{{titanDamage}}</ion-text>
                            <ion-text *ngIf="titanDamage!=titanDamageOld" class="stat-diff" [ngClass]="titanDamage>titanDamageOld?'increase-val':'decrease-val'"><ion-icon [name]="titanDamage>titanDamageOld?'caret-up':'caret-down'"></ion-icon>{{titanDamage-titanDamageOld}}</ion-text>
                          </div>
                        </ion-item>
                        <ion-item lines="none" class="ion-text-wrap">
                          <ion-img src="assets/icon/stats/Reduction.png"></ion-img>
                          <div class="stat-val">
                            <ion-text>Damage Reduction</ion-text><br>
                            <ion-text>{{titanReduction}}</ion-text>
                            <ion-text *ngIf="titanReduction!=titanReductionOld" class="stat-diff" [ngClass]="titanReduction>titanReductionOld?'increase-val':'decrease-val'"><ion-icon [name]="titanReduction>titanReductionOld?'caret-up':'caret-down'"></ion-icon>{{titanReduction-titanReductionOld}}</ion-text>
                          </div>
                        </ion-item>
                        <ion-item lines="none" class="ion-text-wrap">
                          <ion-img src="assets/icon/stats/Heal.png"></ion-img>
                          <div class="stat-val">
                            <ion-text>Increased Healing</ion-text><br>
                            <ion-text>{{titanHeal}}</ion-text>
                            <ion-text *ngIf="titanHeal!=titanHealOld" class="stat-diff" [ngClass]="titanHeal>titanHealOld?'increase-val':'decrease-val'"><ion-icon [name]="titanHeal>titanHealOld?'caret-up':'caret-down'"></ion-icon>{{titanHeal-titanHealOld}}</ion-text>
                          </div>
                        </ion-item>
                      </ion-col>
                    </ion-row>
                  </ion-grid>
                </ion-item>
                <ion-item *ngIf="changedOnly" lines="none" class="ion-text-wrap">
                  <ion-grid class="stats">
                    <ion-row>
                      <ion-col *ngIf="changedStats.length==0">
                        <ion-item lines="none" class="ion-text-wrap">
                          <div class="stat-val">
                            <ion-text><i>Nothing changed yet...</i></ion-text><br>
                          </div>
                        </ion-item>
                      </ion-col>
                      <ion-col *ngIf="changedStats.length>0">
                        <ion-item *ngFor="let s of changedStats" lines="none" class="ion-text-wrap">
                          <ion-img [src]="'assets/icon/stats/'+s.iconname+'.png'"></ion-img>
                          <div class="stat-val">
                            <ion-text>{{s.name}}</ion-text><br>
                            <ion-text>{{s.val}}</ion-text>
                            <ion-text class="stat-diff" [ngClass]="s.increase>0?'increase-val':'decrease-val'"><ion-icon [name]="s.increase>0?'caret-up':'caret-down'"></ion-icon>{{s.increase}}</ion-text>
                          </div>
                        </ion-item>
                      </ion-col>
                    </ion-row>
                  </ion-grid>
                </ion-item>
              </ion-list>
            </ion-card-content>
          </ion-card>
        </ion-row>
      </div>
    </div>
    <div [ngClass]="selectedChar==''?'hidden':''">
      <ion-row>
        <ion-card>
          <ion-card-header>
            <ion-card-title>Estimated Damage</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            <ion-label class="subtitle">Matrix set effects not added yet</ion-label>
            <canvas #graphcanvas height="300"></canvas>
          </ion-card-content>
        </ion-card>
      </ion-row>
    </div>
  </ion-grid>
</ion-content>
